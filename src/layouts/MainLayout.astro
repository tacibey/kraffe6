---
// src/layouts/MainLayout.astro

import Meta from "@components/Meta.astro";
import Navbar from "@components/sections/navbar&footer/Navbar.astro";
import FooterSection from "@components/sections/navbar&footer/FooterSection.astro";
import AnnouncementBanner from "@components/ui/banners/AnnouncementBanner.astro";
import { SITE } from "@data/constants";
import "@styles/global.css";
import { getRelativeLocaleUrl } from "astro:i18n";

const { title = SITE.title, meta, structuredData, lang = "en" } = Astro.props;

interface Props {
  title?: string;
  meta?: string;
  structuredData?: object;
  lang?: string;
}

const currentLang = Astro.currentLocale || 'en';
const contactUrl = getRelativeLocaleUrl(currentLang, 'contact');
const buttonText = currentLang === 'fr' ? 'Obtenir une offre' : 'Get Offer';

// === GOOGLE TAG MANAGER CONTAINER ID ===
const gtmContainerId = "GTM-PZZBN787";
// === /GOOGLE TAG MANAGER CONTAINER ID ===
---

<html lang={lang} class="dark scrollbar-hide lenis lenis-smooth scroll-pt-16">
  <head>
    {/* Meta etiketleri ve diğer başlık bilgileri */}
    <Meta meta={meta} structuredData={structuredData} />
    <title>{title}</title>
    
    {/* KRİTİK CSS BAŞLANGICI - LCP ELEMENTİ İÇİN */}
    <style is:inline>
      /* Bu CSS, HeroSection'daki h1 başlığının ve container'ının hemen stilini sağlar. */
      /* Eğer bu H1 dışında farklı LCP elementleriniz varsa, onların kritik stillerini de buraya eklemeniz gerekebilir. */
      
      /* HeroSection'ın genişliği ve hizalaması */
      /* Bu stil tahmini olarak HeroSection'ın genişliğini ve merkezlemesini kontrol ediyor. */
      /* HeroSection bileşeninizin iç yapısına göre bu stil değişebilir */
      /* Önemli Not: Tailwind sınıfları derlendikten sonra bu hale gelir. */
      /* Bu sınıfların gerçek CSS değerlerini öğrenmek için tarayıcının geliştirici araçlarını kullanmalısınız. */
      /* Ancak şimdilik genel bir tahminle ekliyoruz. */
      
      /* .hero-section-container (HeroSection'ın dış div'i) */
      .mx-auto {
        margin-left: auto;
        margin-right: auto;
      }
      .max-w-\[85rem\] { /* Yaklaşık 1360px */
        max-width: 85rem;
      }
      .px-4 {
        padding-left: 1rem;
        padding-right: 1rem;
      }
      .sm\:px-6 {
        padding-left: 1.5rem;
        padding-right: 1.5rem;
      }
      .lg\:px-8 {
        padding-left: 2rem;
        padding-right: 2rem;
      }
      .items-center {
        align-items: center;
      }
      .gap-8 {
        gap: 2rem;
      }
      .grid-cols-1 {
        grid-template-columns: repeat(1, minmax(0, 1fr));
      }
      @media (min-width: 768px) {
        .md\:grid-cols-2 {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }
      
      /* h1 başlığı için kritik stiller */
      /* `block text-balance text-3xl font-bold tracking-tight text-neutral-800 dark:text-yellow-400` */
      h1.block {
        display: block;
      }
      h1.text-3xl {
        font-size: 1.875rem; /* 30px */
        line-height: 2.25rem; /* 36px */
      }
      h1.font-bold {
        font-weight: 700;
      }
      h1.tracking-tight {
        letter-spacing: -0.025em; /* -0.4px */
      }
      h1.text-neutral-800 {
        color: #3b3b3b; /* Veya kullandığınız tam renk kodu */
      }
      @media (prefers-color-scheme: dark) {
        h1.dark\:text-yellow-400 {
          color: #facc15; /* Tailwind'in yellow-400 rengi */
        }
      }
      
      /* Eğer HeroSection içindeki span'in stilini de isterseniz */
      .text-yellow-500 {
        color: #eab308; /* Tailwind'in yellow-500 rengi */
      }
      @media (prefers-color-scheme: dark) {
        .dark\:text-yellow-400 {
          color: #facc15;
        }
      }

      /* Sayfadaki genel gövde stilinin gecikmesini azaltmak için */
      body.bg-neutral-200 {
        background-color: #e5e7eb; /* tailwind neutral-200 */
      }
      @media (prefers-color-scheme: dark) {
        body.dark\:bg-neutral-800 {
          background-color: #3b3b3b; /* tailwind neutral-800 */
        }
      }

      /* Genel HTML'in `scroll-pt-16` sınıfını da ekleyelim */
      html.scroll-pt-16 {
        scroll-padding-top: 4rem; /* 64px */
      }
      
      /* Lenis ve scrollbar-hide için de başlangıç stilleri */
      html.scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      html.scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

    </style>
    {/* KRİTİK CSS BİTİŞİ */}
    
    {/* Lenis smooth scroll scripti */}
    <script>
      import "@scripts/lenisSmoothScroll.js";
    </script>

    {/* === GOOGLE TAG MANAGER KODU (HEAD) BAŞLANGICI === */}
    {gtmContainerId && (
      <script is:inline define:vars={{ gtmContainerId }}>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer',gtmContainerId);
      </script>
    )}
    {/* === GOOGLE TAG MANAGER KODU (HEAD) SONU === */}

  </head>
  <body
    class="bg-neutral-200 selection:bg-yellow-400 selection:text-neutral-700 dark:bg-neutral-800"
  >
    {/* === GOOGLE TAG MANAGER (NOSCRIPT) KODU (BODY BAŞLANGICI) === */}
    {gtmContainerId && (
      <noscript><iframe src={`https://www.googletagmanager.com/ns.html?id=${gtmContainerId}`} height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    )}
    {/* === /GOOGLE TAG MANAGER (NOSCRIPT) KODU === */}

    <div class="mx-auto max-w-(--breakpoint-2xl) px-4 sm:px-6 lg:px-8">
      <Navbar />
      <main>
        <slot /> {/* Sayfa içeriği buraya gelecek */}
      </main>
    </div>

    <AnnouncementBanner
      btnId="floating-offer-button"
      btnTitle={buttonText}
      url={contactUrl}
    />

    <FooterSection />

    <script>
      import "preline/preline.js";
    </script>
    <style>
      /* global.css'den gelen ve tüm site için geçerli olan diğer stiller */
      /* Bu kısım mevcut haliyle kalmalı, çünkü diğer stiller hala global.css'den yüklenecek. */
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
    </style>
  </body>
</html>
